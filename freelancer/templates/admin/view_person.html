{% extends 'admin/base.html' %}
{% block content %}
    <style>
        .edit_control {
            display: none;
        }
    </style>
    <div class="card bg-transparent border-0">
        <div class="card-body">
            <nav aria-label="breadcrumb" style="--bs-breadcrumb-divider: '>';">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/admin">Home</a></li>
                    <li class="breadcrumb-item"><a href="/contacts">Contacts</a></li>
                    <li class="breadcrumb-item active text-capitalize" aria-current="page">{{ person['name'] }}</li>
                </ol>
            </nav>
        </div>
    </div>
    <div id="alert"></div>
    <h1 class="text-capitalize my-3">
        {{ person['name'] }}
    </h1>
    <div class="row">
        <div class="col-md-3">
            <div class="d-grid">
                <label class="btn mb-3" for="flexSwitchCheckChecked">
                    <div class="form-check form-switch text-start fs-5">
                        <input onclick="edit_control_toggle()" class="form-check-input" type="checkbox"
                               id="flexSwitchCheckChecked">
                        EDIT
                    </div>
                </label>
            </div>
            <div class="card mb-3">
                <div class="card-header"><span class="bi-phone"></span> MOBILE NUMBER</div>
                <div class="card-body edit_control">
                    <form name="add_contact_number_form" onsubmit="submit_add_contact_number_form(this)">
                        <div class="input-group">
                            <input name="number" placeholder="Type Number here"
                                   class="form-control bg-light border-light"
                                   type="text" required/>
                            <button type="submit" class=" btn btn-primary">
                                ADD
                            </button>
                        </div>
                    </form>
                </div>
                <div id="contact_number_list" class="list-group list-group-flush">
                    {% for number in person['numbers'] %}
                        <div class="list-group-item">
                            {{ number }}
                            <button onclick="remove_contact_number(this, '{{ number }}')" class="float-end btn ">
                                <span class="edit_control bi bi-dash-circle-fill text-danger"></span>
                            </button>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <div class="card mb-3">
                <div class="card-header"><span class="bi-mailbox"></span> EMAIL</div>
                <div class="card-body edit_control">
                    <form name="add_email_form" onsubmit="submit_add_email_form(this)">
                        <div class="input-group">
                            <input name="email" placeholder="Type email here" class="bg-light border-light form-control"
                                   type="text" required/>
                            <button type="submit" class=" btn btn-primary">
                                ADD
                            </button>
                        </div>
                    </form>
                </div>
                <div id="email_list" class="list-group list-group-flush">
                    {% for email in person['emails'] %}
                        <div class="list-group-item">{{ email }}
                            <button onclick="remove_email(this, '{{ email }}')" class="float-end btn edit_control">
                                <span class="bi bi-dash-circle-fill text-danger"></span>
                            </button>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <div class="card mb-3">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        <span class="text-capitalize">{{ functions.source_type[person['source_type']] }}</span><br/>
                        <small class="text-muted">SOURCE TYPE</small>
                    </li>
                    <li class="list-group-item">
                        <span class="text-capitalize">{{ person['source_data'] }}</span><br/>
                        <small class="text-muted">SOURCE</small>
                    </li>
                </ul>
            </div>

            <div class="card bg-light border-0 mb-3">
                <div class="card-body edit_control">
                    <div class="d-grid">
                        <button class="btn btn-danger" onclick="delete_person()">
                            DELETE PERSON
                        </button>
                    </div>
                </div>
            </div>


        </div>
        <div class="col-md-9">
            <ul class="nav nav-pills nav-fill mb-3" id="pills-tab" role="tablist">
                <li class="nav-item" role="presentation">
                    <a class="nav-link active" data-bs-toggle="pill" href="#vehicle_list_tab"
                       role="tab">
                        MOTOR <span
                            class="float-end badge rounded-pill bg-white border-primary text-primary">{{ person.registration_list|length }}</span>
                    </a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" data-bs-toggle="pill" href="#health_list_tab"
                       role="tab">
                        HEALTH <span
                            class="float-end badge rounded-pill bg-white border-primary text-primary">{{ person['health_policy_list']|length }}</span>
                    </a>
                </li>
            </ul>
            <div class="tab-content" id="pills-tabContent">
                <div class="tab-pane fade show active" id="vehicle_list_tab" role="tabpanel">
                    <div class="mb-3">
                        <button data-bs-toggle="modal" data-bs-target="#add_vehicle_modal"
                                class="btn btn-primary">
                            ADD VEHICLE
                        </button>
                    </div>

                    <div class="list-group">
                        {% for vehicle in person.registration_list %}
                            <div class="list-group-item mb-3 border-1">
                                <div class="row">
                                    <div class="col-10">
                                        <h4 class="card-title text-uppercase my-3">
                                            {{ vehicle['registration_number'] }} <br/>
                                            <small class="text-muted">{{ vehicle['registration_name'] }}</small>
                                        </h4>
                                    </div>
                                    <div class="col-2">
                                        <button class="btn text-primary float-end"
                                                onclick="view_vehicle('{{ vehicle['_id'] }}')">
                                            EDIT
                                        </button>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-lg-6 mb-3">
                                        <table class="text-uppercase table table-borderless table-striped table-sm">
                                            <tr>
                                                <td class="text-muted">Number</td>
                                                <td>{{ vehicle['registration_number'] }}</td>
                                            </tr>
                                            <tr>
                                                <td class="text-muted">Name</td>
                                                <td>{{ vehicle['registration_name'] }}</td>
                                            </tr>
                                            <tr>
                                                <td class="text-muted">Make - Model</td>
                                                <td>
                                                    {{ vehicle['company'] }} - {{ vehicle['model'] }}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="text-muted">Reg Date</td>
                                                <td>{{ functions.format_timestamp(vehicle['registration_date'], '%d-%m-%Y') }}</td>
                                            </tr>
                                            <tr>
                                                <td class="text-muted">MFG Year</td>
                                                <td>{{ vehicle['mfg'] }}</td>
                                            </tr>
                                            <tr>
                                                <td class="text-muted">CC</td>
                                                <td>{{ vehicle['cc'] }}</td>
                                            </tr>
                                            <tr>
                                                <td class="text-muted">Fuel Type</td>
                                                <td>{{ vehicle['fuel'] }}</td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="col-lg-6 mb-3">
                                        <p>
                                            <span class="fs-5">Policy List</span>
                                            <button class="btn btn-light text-primary float-end"
                                                    onclick="add_vehicle_policy('{{ vehicle['registration_number'] }}', '{{ vehicle['_id'] }}')">
                                                ADD POLICY
                                            </button>
                                        </p>
                                        <div class="list-group list-group-flush">
                                            {% for policy in vehicle.motor_policy_list %}
                                                <button onclick="view_vehicle_policy('{{ policy['_id'] }}')"
                                                        class="border-0 list-group-item list-group-item-action">
                                                    <span class="text-muted d-inline-block">{{ functions.format_timestamp(policy['expiry_date'], '%d-%m-%Y') }}</span>
                                                    <span class="d-inline-block float-end">{{ policy['policy_number'] }}</span>
                                                </button>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="tab-pane fade" id="health_list_tab" role="tabpanel">
                    <div class="mb-3">
                        <button data-bs-toggle="modal" data-bs-target="#add_health_policy_modal"
                                class="btn btn-primary">
                            ADD HEALTH POLICY
                        </button>
                    </div>
                    <div class="list-group">
                        {% for policy in person['health_policy_list'] %}
                            <button onclick="view_health_policy('{{ policy['_id'] }}')"
                                    class="list-group-item list-group-item-action">
                                <span class="text-muted d-inline-block">{{ functions.format_timestamp(policy['expiry_date'], '%d-%m-%Y') }}</span>
                                <span class="d-inline-block">{{ policy['policy_owner'] }}</span>
                            </button>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="add_vehicle_modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ADD VEHICLE</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form onsubmit="submit_add_vehicle_form(this)" name="add_vehicle_form">
                        <label for="registration_number" class="form-label">Registraion Number</label>
                        <input type="text" id="registration_number" name="registration_number" class="form-control mb-2"
                               required/>
                        <label for="registration_name" class="form-label">Registration Name</label>
                        <input type="text" id="registration_name" name="registration_name" class="form-control mb-2"/>
                        <label for="registration_date" class="form-label">Registration Date</label>
                        <input type="date" id="registration_date" name="registration_date" class="form-control mb-2"/>
                        <label for="company" class="form-label">Company</label>
                        <input type="text" id="company" name="company" class="form-control mb-2"/>
                        <label for="model" class="form-label">Model</label>
                        <input type="text" id="model" name="model" class="form-control mb-2"/>
                        <label for="cc" class="form-label">CC</label>
                        <input type="text" id="cc" name="cc" class="form-control mb-2"/>
                        <label for="fuel" class="form-label">Fuel Type</label>
                        <select class="form-select mb-2" name="fuel" id="fuel">
                            <option value="">Select Fuel Type</option>
                            <option value="petrol">Petrol</option>
                            <option value="diesel">Diesel</option>
                        </select>
                        <label for="mfg" class="form-label">MFG Year</label>
                        <input type="text" id="mfg" name="mfg" class="form-control mb-2"/>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">SUBMIT</button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>

    <div class="modal fade" id="view_vehicle_modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>EDIT VEHICLE</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form onsubmit="submit_update_vehicle_form(this)" name="update_vehicle_form">
                        <input type="hidden" name="registration_id" value="">
                        <label for="registration_number" class="form-label">Registraion Number</label>
                        <input type="text" id="registration_number" name="registration_number" class="form-control mb-2"
                               required/>
                        <label for="registration_name" class="form-label">Registration Name</label>
                        <input type="text" id="registration_name" name="registration_name" class="form-control mb-2"/>
                        <label for="registration_date" class="form-label">Registration Date</label>
                        <input type="date" id="registration_date" name="registration_date" class="form-control mb-2"/>
                        <label for="company" class="form-label">Company</label>
                        <input type="text" id="company" name="company" class="form-control mb-2"/>
                        <label for="model" class="form-label">Model</label>
                        <input type="text" id="model" name="model" class="form-control mb-2"/>
                        <label for="cc" class="form-label">CC</label>
                        <input type="text" id="cc" name="cc" class="form-control mb-2"/>
                        <label for="fuel" class="form-label">Fuel Type</label>
                        <select class="form-select mb-2" name="fuel" id="fuel">
                            <option value="">Select Fuel Type</option>
                            <option value="petrol">Petrol</option>
                            <option value="diesel">Diesel</option>
                        </select>
                        <label for="mfg" class="form-label">MFG Year</label>
                        <input type="number" class="form-control mb-2" name="mfg" id="mfg"/>
                        <div class="d-grid mb-3">
                            <button type="submit" class="btn btn-primary">
                                UPDATE
                            </button>
                        </div>
                        <div class="text-end">
                            <button type="button" onclick="delete_vehicle()"
                                    class="btn btn-light text-danger">
                                <span class="bi bi-trash"></span> DELETE
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="add_vehicle_policy_modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>ADD VEHICLE POLICY</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form name="add_vehicle_policy_form" onsubmit="submit_add_vehicle_policy_form(this)">
                        <div class="form-check mb-2">
                            <input class="form-check-input" name="own_business" type="checkbox" value="True"
                                   id="own_business">
                            <label class="form-check-label" for="own_business">
                                Own Business
                            </label>
                        </div>
                        <label class="form-label" for="registration_number">Registration Number</label>
                        <input type="text" class="form-control mb-2" name="registration_number" id="registration_number"
                               disabled/>
                        <label for="expiry_date" class="form-label">Expiry Date</label>
                        <input type="date" class="form-control mb-2" name="expiry_date" id="expiry_date" required/>
                        <label for="policy_number" class="form-label">Policy Number</label>
                        <input type="text" class="form-control mb-2" name="policy_number" id="policy_number"/>
                        <label for="policy_type" class="form-label">Policy Type</label>
                        <select class="form-select mb-2" name="policy_type" id="policy_type">
                            <option value="" selected>Select Type</option>
                            <option value="od_tp">Normal (OD+TP)</option>
                            <option value="tp">Third Party Only</option>
                            <option value="tentative">Tentative</option>
                            <option value="od">Own Damange Only</option>
                        </select>
                        <div class="form-check mb-2">
                            <input class="form-check-input" name="o_dap" type="checkbox" value="True" id="o_dap">
                            <label class="form-check-label" for="o_dap">
                                0 DAP Cover
                            </label>
                        </div>
                        <label for="company" class="form-label">Company</label>
                        <input type="text" class="form-control mb-2" name="company" id="company"/>
                        <label for="idv" class="form-label">IDV</label>
                        <input type="text" class="form-control mb-2" name="idv" id="idv"/>
                        <label for="ncb" class="form-label">NCB %</label>
                        <select class="form-select mb-2" name="ncb" id="ncb">
                            <option value="" selected>SELECT</option>
                            <option value="0">0%</option>
                            <option value="20">20%</option>
                            <option value="25">25%</option>
                            <option value="35">35%</option>
                            <option value="45">45%</option>
                            <option value="50">50%</option>
                        </select>
                        <label for="premium" class="form-label">Premium</label>
                        <input type="text" class="form-control mb-2" name="premium" id="premium"/>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">SUBMIT</button>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="view_vehicle_policy_modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>MOTOR POLICY DETAILS</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>
                        <button class="btn btn-light text-primary" onclick="view_edit_motor_policy_modal()">EDIT
                        </button>
                        <a href="#" class="btn btn-link float-end" target="_blank" id="view_motor_renewal_button">VIEW
                            RENEWAL
                            PAGE
                            <span class="bi bi-box-arrow-in-up-right"></span> </a>
                    </p>
                    <p id="motor_policy_table_own_business"></p>
                    <table id="motor_policy_table" class="table table-borderless table-striped text-uppercase">
                        <tbody>
                        <tr>
                            <td class="text-muted">Policy Number</td>
                            <td id="motor_policy_table_policy_number"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">Policy Company</td>
                            <td id="motor_policy_table_company"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">Expiry Date</td>
                            <td id="motor_policy_table_expiry_date"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">Policy Type</td>
                            <td id="motor_policy_table_policy_type"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">Premium</td>
                            <td id="motor_policy_table_premium"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">IDV</td>
                            <td id="motor_policy_table_idv"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">NCB %</td>
                            <td id="motor_policy_table_ncb"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">Claim Status</td>
                            <td id="motor_policy_table_claim_status"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">Addon Cover</td>
                            <td id="motor_policy_table_addon_cover"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="edit_vehicle_policy_modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>EDIT VEHICLE POLICY</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form name="edit_vehicle_policy_form" onsubmit="submit_edit_vehicle_policy_form(this)">
                        <input type="hidden" name="policy_id" id="policy_id" value=""/>
                        <div class="form-check mb-2">
                            <input class="form-check-input" name="own_business" type="checkbox" value="True"
                                   id="own_business">
                            <label class="form-check-label" for="own_business">
                                Own Business
                            </label>
                        </div>
                        <label class="form-label" for="policy_number">Policy Number</label>
                        <input type="text" class="form-control mb-2" name="policy_number" id="policy_number"/>
                        <label for="expiry_date" class="form-label">Expiry Date</label>
                        <input type="date" class="form-control mb-2" name="expiry_date" id="expiry_date" required/>
                        <label for="policy_type" class="form-label">Policy Type</label>
                        <select class="form-select mb-2" name="policy_type" id="policy_type">
                            <option value="" selected>Select Type</option>
                            <option value="od_tp">Normal (OD+TP)</option>
                            <option value="tp">Third Party Only</option>
                            <option value="tentative">Tentative</option>
                            <option value="od">Own Damange Only</option>
                        </select>
                        <label class="form-label fw-bold">Addon Cover</label>
                        <div class="form-check mb-2">
                            <input class="form-check-input" name="o_dap" type="checkbox" value="True" id="o_dap">
                            <label class="form-check-label" for="o_dap">
                                0 DAP Cover
                            </label>
                        </div>
                        <div class="">
                            <label class="form-label fw-bold">Claim Status - </label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" value="true" type="radio" name="claim_status"
                                       id="motor_claim_status_yes">
                                <label class="form-check-label" for="motor_claim_status_yes">
                                    Yes
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" value="false" type="radio" name="claim_status"
                                       id="motor_claim_status_no">
                                <label class="form-check-label" for="motor_claim_status_no">
                                    No
                                </label>
                            </div>
                        </div>
                        <label for="company" class="form-label">Company</label>
                        <input type="text" class="form-control mb-2" name="company" id="company"/>
                        <label for="idv" class="form-label">IDV</label>
                        <input type="text" class="form-control mb-2" name="idv" id="idv"/>
                        <label for="ncb" class="form-label">NCB %</label>
                        <select class="form-select mb-2" name="ncb" id="ncb">
                            <option value="" selected>SELECT</option>
                            <option value="0">0%</option>
                            <option value="20">20%</option>
                            <option value="25">25%</option>
                            <option value="35">35%</option>
                            <option value="45">45%</option>
                            <option value="50">50%</option>
                        </select>
                        <label for="premium" class="form-label">Premium</label>
                        <input type="text" class="form-control mb-2" name="premium" id="premium"/>
                        <div class="d-grid mb-3">
                            <button type="submit" class="btn btn-primary">UPDATE</button>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-light text-danger" onclick="delete_vehicle_policy()">
                                <span class="bi bi-trash"></span> DELETE
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="add_health_policy_modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>ADD HEALTH POLICY</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form name="add_health_policy_form" onsubmit="submit_add_health_policy_form(this)">
                        <div class="form-check mb-2">
                            <input class="form-check-input" name="own_business" type="checkbox" value="True"
                                   id="own_business">
                            <label class="form-check-label" for="own_business">
                                Own Business
                            </label>
                        </div>
                        <label for="expiry_date" class="form-label">Expiry Date</label>
                        <input type="date" class="form-control mb-2" name="expiry_date" id="expiry_date" required/>
                        <label for="policy_owner" class="form-label">Policy Owner Name</label>
                        <input type="text" class="form-control mb-2" name="policy_owner" id="policy_owner"/>
                        <label for="policy_number" class="form-label">Policy Number</label>
                        <input type="text" class="form-control mb-2" name="policy_number" id="policy_number"/>
                        <label for="company" class="form-label">Company</label>
                        <input type="text" class="form-control mb-2" name="company" id="company"/>
                        <label for="policy_type" class="form-label">Plan Name</label>
                        <input type="text" class="form-control mb-2" name="policy_type" id="policy_type"/>
                        <label for="idv" class="form-label">Sum Insured Value</label>
                        <input type="text" class="form-control mb-2" name="idv" id="idv"/>
                        <label for="ncb" class="form-label">NCB %</label>
                        <select class="form-select mb-2" name="ncb" id="ncb">
                            <option value="" selected>SELECT</option>
                            <option value="0">0%</option>
                            <option value="20">20%</option>
                            <option value="25">25%</option>
                            <option value="35">35%</option>
                            <option value="45">45%</option>
                            <option value="50">50%</option>
                        </select>
                        <label for="premium" class="form-label">Premium</label>
                        <input type="text" class="form-control mb-2" name="premium" id="premium"/>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">SUBMIT</button>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="view_health_policy_modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>HEALTH POLICY DETAILS</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>
                        <button class="btn btn-light text-primary" onclick="view_edit_health_policy_modal()">EDIT
                        </button>
                        <a href="#" class="btn btn-link float-end" target="_blank" id="view_health_renewal_button">VIEW
                            RENEWAL
                            PAGE
                            <span class="bi bi-box-arrow-in-up-right"></span> </a>
                    </p>
                    <table id="motor_policy_table" class="table table-borderless table-striped text-uppercase">
                        <tbody>
                        <tr>
                            <td class="text-muted">Policy Owner</td>
                            <td id="health_policy_table_policy_owner"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">Policy Number</td>
                            <td id="health_policy_table_policy_number"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">Policy Company</td>
                            <td id="health_policy_table_company"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">Expiry Date</td>
                            <td id="health_policy_table_expiry_date"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">Policy Type</td>
                            <td id="health_policy_table_policy_type"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">Premium</td>
                            <td id="health_policy_table_premium"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">IDV</td>
                            <td id="health_policy_table_idv"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">NCB %</td>
                            <td id="health_policy_table_ncb"></td>
                        </tr>
                        <tr>
                            <td class="text-muted">Claim Status</td>
                            <td id="health_policy_table_claim_status"></td>
                        </tr>
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="edit_health_policy_modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>EDIT HEALTH POLICY</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form name="edit_health_policy_form" onsubmit="submit_edit_health_policy_form(this)">
                        <input type="hidden" name="policy_id" id="policy_id" value=""/>
                        <div class="form-check mb-2">
                            <input class="form-check-input" name="own_business" type="checkbox" value="True"
                                   id="own_business">
                            <label class="form-check-label" for="own_business">
                                Own Business
                            </label>
                        </div>
                        <label class="form-label" for="policy_number">Policy Number</label>
                        <input type="text" class="form-control mb-2" name="policy_number" id="policy_number"/>
                        <label class="form-label" for="policy_owner">Policy Owner</label>
                        <input type="text" class="form-control mb-2" name="policy_owner" id="policy_owner"/>
                        <label for="expiry_date" class="form-label">Expiry Date</label>
                        <input type="date" class="form-control mb-2" name="expiry_date" id="expiry_date" required/>
                        <label for="policy_type" class="form-label">Policy Plan</label>
                        <input type="text" class="form-control mb-2" name="policy_type" id="policy_type"/>
                        <label for="company" class="form-label">Company</label>
                        <input type="text" class="form-control mb-2" name="company" id="company"/>
                        <label for="idv" class="form-label">IDV</label>
                        <input type="text" class="form-control mb-2" name="idv" id="idv"/>
                        <div class="">
                            <label class="form-label fw-bold">Claim Status - </label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" value="true" type="radio" name="claim_status"
                                       id="motor_claim_status_yes">
                                <label class="form-check-label" for="motor_claim_status_yes">
                                    Yes
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" value="false" type="radio" name="claim_status"
                                       id="motor_claim_status_no">
                                <label class="form-check-label" for="motor_claim_status_no">
                                    No
                                </label>
                            </div>
                        </div>
                        <label for="ncb" class="form-label">NCB %</label>
                        <select class="form-select mb-2" name="ncb" id="ncb">
                            <option value="" selected>SELECT</option>
                            <option value="0">0%</option>
                            <option value="20">20%</option>
                            <option value="25">25%</option>
                            <option value="35">35%</option>
                            <option value="45">45%</option>
                            <option value="50">50%</option>
                        </select>
                        <label for="premium" class="form-label">Premium</label>
                        <input type="text" class="form-control mb-2" name="premium" id="premium"/>
                        <div class="d-grid mb-3">
                            <button type="submit" class="btn btn-primary">UPDATE</button>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-light text-danger" onclick="delete_health_policy()">
                                <span class="bi bi-trash"></span> DELETE
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block foot %}
    <script>

        person_id = '{{ person['_id'] }}'
        person_name = '{{ person['name'] }}'
        var current_vehicle_registration_number = ''
        var current_vehicle_registration_id = ''
        var current_vehicle_policy_id = ''

        function submit_add_contact_number_form(form) {
            event.preventDefault()
            number = form.number.value.trim()
            if (number == '') {
                show_alert('Number cannot be empty!', 'warning')
            } else {
                $.ajax({
                    url: '/api/add_contact_number',
                    type: 'POST',
                    data: {'_id': person_id, 'number': number},
                    dataType: 'JSON',
                    success: function (response) {
                        if (response.result == true) {
                            $('#add_contact_number_collapse').collapse('hide')
                            html = '<li class="list-group-item">' + number +
                                '<button onclick="remove_contact_number(this, \'' + number + '\')" class="float-end btn ">' +
                                '<span class="bi bi-dash-circle-fill text-danger edit_control" style="display: block"></span></button></li>'
                            $(html).appendTo($('#contact_number_list')).hide().slideDown('slow').effect('highlight')
                            form.reset()
                        } else {
                            show_alert('Error: ' + response.msg, 'error')
                        }
                    }
                })

            }
        }

        function remove_contact_number(e, number) {
            if (confirm('Delete Number ' + number + ' ?')) {
                $.ajax({
                    url: '/api/remove_contact_number',
                    type: 'POST',
                    data: {'_id': person_id, 'number': number},
                    dataType: 'JSON',
                    success: function (response) {
                        if (response.result == true) {
                            show_alert('Number deleted Successfully.', 'success', 'alert', 'toast')
                            $(e).parent().slideUp(function () {
                                $(e).parent().remove()
                            })
                        } else {
                            show_alert(response.msg, 'error', 'alert', 'toast')
                        }
                    }
                })
            }
        }

        function submit_add_email_form(form) {
            event.preventDefault()
            email = form.email.value.trim()
            if (email == '') {
                show_alert('Email cannot be empty!', 'warning')
            } else {
                $.ajax({
                    url: '/api/add_contact_email',
                    type: 'POST',
                    data: {'_id': person_id, 'email': email},
                    dataType: 'JSON',
                    success: function (response) {
                        if (response.result == true) {
                            $('#add_email_collapse').collapse('hide')
                            html = '<li class="list-group-item">' + email +
                                '<button onclick="remove_email(this, \'' + email + '\')" class="float-end btn ">' +
                                '<span class="bi bi-dash-circle-fill text-danger edit_control" style="display: block"></span></button></li>'
                            $(html).appendTo($('#email_list')).hide().slideDown('slow').effect('highlight')
                            form.reset()
                        } else {
                            show_alert('Error: ' + response.msg, 'error')
                        }
                    }
                })

            }
        }

        function remove_email(e, email) {
            if (confirm('Delete email ' + email + ' ?')) {
                $.ajax({
                    url: '/api/remove_email',
                    type: 'POST',
                    data: {'_id': person_id, 'email': email},
                    dataType: 'JSON',
                    success: function (response) {
                        if (response.result == true) {
                            show_alert('Email deleted successfully.', 'success', 'alert', 'toast')
                            $(e).parent().slideUp(function () {
                                $(e).parent().remove()
                            })
                        } else {
                            show_alert(response.msg, 'error')
                        }
                    }
                })
            }
        }

        function delete_person() {
            if (confirm('This will delete all data related to ' + person_name + '.\nAre you sure ?')) {
                $.ajax({
                    url: '/api/delete_person',
                    type: 'POST',
                    data: {'person_id': person_id},
                    dataType: 'JSON',
                    success: function (response) {
                        if (response.result == true) {
                            window.location.replace("/contacts");
                        } else {
                            show_alert(response.msg, 'error')
                        }
                    }
                })
            }
        }

        function submit_add_vehicle_form(form) {
            event.preventDefault()
            data = $(form).serializeArray()
            data.push({'name': 'person_id', 'value': person_id})
            console.log(data)
            $.ajax({
                url: '/api/add_vehicle',
                data: data,
                type: 'POST',
                dataType: 'JSON',
                success: function (response) {
                    if (response.result == true) {
                        form.reset()
                        $('#add_vehicle_modal').modal('hide')
                        show_alert('Successfully added.', 'success')
                        location.reload()
                    } else {
                        alert(response.msg)
                    }
                }
            })
        }

        function view_vehicle(registration_id) {
            form = document.update_vehicle_form
            $.ajax({
                url: '/api/view_vehicle',
                type: 'POST',
                data: {'registration_id': registration_id},
                dataType: 'JSON',
                success: function (response) {
                    if (response.result == true) {
                        form['registration_id'].value = response.data._id.$oid
                        for (i of ['registration_number', 'registration_name', 'company', 'model', 'cc', 'fuel', 'mfg']) {
                            form[i].value = response.data[i]
                        }
                        registration_date = response.data.registration_date
                        if (registration_date != null) {
                            registration_date = formatdateinput(registration_date.$date)
                        }
                        form.registration_date.value = registration_date
                    } else {
                        alert(response.msg)
                    }
                }
            })
            $('#view_vehicle_modal').modal('show')
        }

        function submit_update_vehicle_form(form) {
            event.preventDefault()
            data = $(form).serialize()
            $.ajax({
                url: '/api/update_vehicle',
                type: 'POST',
                data: data,
                dataType: 'JSON',
                success: function (response) {
                    if (response.result == true) {
                        $('#view_vehicle_modal').modal('hide')
                        show_alert('successfully updated vehicle details.', 'success')
                        location.reload()
                    } else {
                        alert(response.msg)
                    }
                }
            })
        }

        function delete_vehicle() {
            if (confirm('This will delete vehicle data and its policy data!')) {
                registration_id = document.update_vehicle_form.registration_id.value
                $.ajax({
                    url: '/api/delete_vehicle',
                    type: 'POST',
                    data: {'registration_id': registration_id},
                    dataType: 'JSON',
                    success: function (response) {
                        if (response.result == true) {
                            location.reload()
                        } else {
                            alert(response.msg)
                        }
                    }
                })
            }
        }

        function add_vehicle_policy(registration_number, registration_id) {
            current_vehicle_registration_number = registration_number
            current_vehicle_registration_id = registration_id
            document.add_vehicle_policy_form.registration_number.value = current_vehicle_registration_number
            $('#add_vehicle_policy_modal').modal('show')
        }

        function submit_add_vehicle_policy_form(form) {
            event.preventDefault()
            data = $(form).serializeArray()
            data.push({'name': 'person_id', 'value': person_id})
            data.push({'name': 'registration_number', 'value': current_vehicle_registration_number})
            data.push({'name': 'registration_id', 'value': current_vehicle_registration_id})
            $.ajax({
                url: '/api/add_motor_policy',
                data: data,
                type: 'POST',
                dataType: 'JSON',
                success: function (response) {
                    if (response.result == true) {
                        show_alert('Policy Successfully added.', 'success')
                        location.reload()
                    } else {
                        alert(response.msg)
                    }
                }
            })
        }

        function view_vehicle_policy(policy_id) {
            current_vehicle_policy_id = null
            form = document.edit_vehicle_policy_form
            $.ajax({
                url: '/api/view_vehicle_policy/' + policy_id,
                dataType: 'JSON',
                success: function (response) {
                    if (response.result == true) {
                        current_vehicle_policy_id = response.data._id.$oid
                        form.policy_id.value = current_vehicle_policy_id
                        document.getElementById('view_motor_renewal_button').setAttribute('href', '/view_motor_policy/' + current_vehicle_policy_id)
                        form.own_business.checked = (response.data['own_business'] === true)
                        if (response.data['own_business'] === true) {
                            document.getElementById('motor_policy_table_own_business').innerHTML = '<span class="badge bg-success fs-6">OWNED POLICY</span>'
                        } else {
                            document.getElementById('motor_policy_table_own_business').innerHTML = ''
                        }
                        form.o_dap.checked = (response.data['o_dap'] === true)
                        if (response.data['o_dap'] === true) {
                            document.getElementById('motor_policy_table_addon_cover').innerHTML = '<span class="badge bg-primary">0 DAP</span>'
                        } else {
                            document.getElementById('motor_policy_table_addon_cover').innerHTML = ''
                        }

                        form.claim_status.value = response.data['claim_status']
                        document.getElementById('motor_policy_table_claim_status').innerText = response.data['claim_status']

                        for (i of ['policy_number', 'policy_type', 'company', 'idv', 'ncb', 'premium']) {
                            form[i].value = document.getElementById('motor_policy_table_' + i).innerHTML = response.data[i]
                        }
                        expiry_date = response.data.expiry_date
                        if (expiry_date != null) {
                            expiry_date = formatdateinput(expiry_date.$date)
                        }
                        form.expiry_date.value = document.getElementById('motor_policy_table_expiry_date').innerHTML = expiry_date
                        $('#view_vehicle_policy_modal').modal('show')
                    } else {
                        alert(response.msg)
                    }
                }
            })
        }

        function submit_edit_vehicle_policy_form(form) {
            event.preventDefault()
            data = $(form).serialize()
            $.ajax({
                url: '/api/update_vehicle_policy',
                type: 'POST',
                data: data,
                dataType: 'JSON',
                success: function (response) {
                    if (response.result == true) {
                        $('#view_vehicle_policy_modal').modal('hide')
                        show_alert('successfully updated policy details.', 'success')
                        location.reload()
                    } else {
                        alert(response.msg)
                    }
                }
            })
        }

        function delete_vehicle_policy() {
            policy_id = current_vehicle_policy_id
            $.ajax({
                url: '/api/delete_vehicle_policy',
                type: 'POST',
                data: {'policy_id': policy_id},
                dataType: 'JSON',
                success: function (response) {
                    if (response.result == true) {
                        location.reload()
                    } else {
                        alert(response.msg)
                    }
                }
            })
        }

        function submit_add_health_policy_form(form) {
            event.preventDefault()
            data = $(form).serializeArray()
            data.push({'name': 'person_id', 'value': person_id})
            $.ajax({
                url: '/api/add_health_policy',
                data: data,
                type: 'POST',
                dataType: 'JSON',
                success: function (response) {
                    if (response.result == true) {
                        show_alert('Policy Successfully added.', 'success')
                        location.reload()
                    } else {
                        alert(response.msg)
                    }
                }
            })
        }

        function view_health_policy(policy_id) {
            current_health_policy_id = null
            form = document.edit_health_policy_form
            $.ajax({
                url: '/api/view_health_policy/' + policy_id,
                dataType: 'JSON',
                success: function (response) {
                    if (response.result == true) {
                        current_health_policy_id = response.data._id.$oid
                        form.policy_id.value = current_health_policy_id
                        document.getElementById('view_health_renewal_button').setAttribute('href', '/view_health_policy/' + current_health_policy_id)
                        form.own_business.checked = (response.data['own_business'] === true)
                        form.claim_status.value = response.data['claim_status']
                        document.getElementById('health_policy_table_claim_status').innerText = response.data['claim_status']
                        for (i of ['policy_owner', 'policy_number', 'policy_type', 'company', 'idv', 'ncb', 'premium']) {
                            form[i].value = document.getElementById('health_policy_table_' + i).innerHTML = response.data[i]
                        }
                        expiry_date = response.data.expiry_date
                        if (expiry_date != null) {
                            expiry_date = formatdateinput(expiry_date.$date)
                        }
                        form.expiry_date.value = expiry_date
                        $('#view_health_policy_modal').modal('show')
                    } else {
                        alert(response.msg)
                    }
                }
            })
        }

        function submit_edit_health_policy_form(form) {
            event.preventDefault()
            data = $(form).serialize()
            $.ajax({
                url: '/api/update_health_policy',
                type: 'POST',
                data: data,
                dataType: 'JSON',
                success: function (response) {
                    if (response.result == true) {
                        $('#view_health_policy_modal').modal('hide')
                        show_alert('successfully updated policy details.', 'success')
                        location.reload()
                    } else {
                        alert(response.msg)
                    }
                }
            })
        }

        function delete_health_policy() {
            policy_id = current_health_policy_id
            $.ajax({
                url: '/api/delete_health_policy',
                type: 'POST',
                data: {'policy_id': policy_id},
                dataType: 'JSON',
                success: function (response) {
                    if (response.result == true) {
                        location.reload()
                    } else {
                        alert(response.msg)
                    }
                }
            })
        }

        function edit_control_toggle() {
            $('.edit_control').toggle('animated')
        }

        function view_edit_motor_policy_modal() {
            $('#view_vehicle_policy_modal').modal('hide').on('hidden.bs.modal', function (e) {
                $('#edit_vehicle_policy_modal').modal('show');

                $(this).off('hidden.bs.modal'); // Remove the 'on' event binding
            });
        }

        function view_edit_health_policy_modal() {
            $('#view_health_policy_modal').modal('hide').on('hidden.bs.modal', function (e) {
                $('#edit_health_policy_modal').modal('show');

                $(this).off('hidden.bs.modal'); // Remove the 'on' event binding
            });
        }
    </script>
{% endblock %}